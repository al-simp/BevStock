{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{Fragment,useState,useEffect}from\"react\";import{Redirect}from\"react-router-dom\";import TopSellerChart from\"../components/TopSellerChart\";import ProductAlerts from\"../components/inventory/ProductAlerts\";import DashBoardStocktaking from\"./DashboardStocktaking\";import StockRecords from\"./inventory/StockRecords\";import _ from\"lodash\";var Dashboard=function Dashboard(_ref){var setAuth=_ref.setAuth,name=_ref.name;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),stocktake=_useState2[0],setStocktake=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),predictedOrder=_useState4[0],setPredictedOrder=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),levels=_useState6[0],setLevels=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),graphLabels=_useState8[0],setGraphLabels=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),graphData=_useState10[0],setGraphData=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),allTimeLabels=_useState12[0],setAllTimeLabels=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),allTimeData=_useState14[0],setAllTimeData=_useState14[1];//get id of stocktake if stocktake in progress\nvar stockId=Number(localStorage.getItem(\"stocktake\"));//if stock ID exists, set stocktake to true.\nvar Stocktake=function Stocktake(){if(stockId!==0){setStocktake(true);}};var getPredictedOrder=function getPredictedOrder(levels){setPredictedOrder(levels.map(function(item){return{name:item.product_name,predictedOrder:Number(Number(item.sum)-item.avg_weekly_sales+item.par_level)};}));};//find levels with pars for product alerts components.\nvar getLevels=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"/inventory/levels/\".concat(localStorage.getItem(\"laststocktake\")),{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context.sent;_context.next=6;return response.json();case 6:parseRes=_context.sent;setLevels(parseRes);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.log(_context.t0.message);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function getLevels(){return _ref2.apply(this,arguments);};}();//get top selling products for chart (week)\nvar getTopSellers=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"/inventory/topsellers/\".concat(localStorage.getItem(\"laststocktake\")),{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:parseRes=_context2.sent;setGraphLabels(parseRes.map(function(product){return product.product_name;}));setGraphData(parseRes.map(function(product){return product.sales;}));_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0.message);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return function getTopSellers(){return _ref3.apply(this,arguments);};}();//get top selling products for chart (all time)\nvar getTopSellersAllTime=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"/inventory/alltimetopsellers/\",{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:parseRes=_context3.sent;setAllTimeLabels(parseRes.map(function(product){return product.product_name;}));setAllTimeData(parseRes.map(function(product){return product.sum;}));_context3.next=14;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0.message);case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[0,11]]);}));return function getTopSellersAllTime(){return _ref4.apply(this,arguments);};}();var getPermission=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:Notification.requestPermission().then(function(result){console.log(result);});case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function getPermission(){return _ref5.apply(this,arguments);};}();//get userType for conditional render\nvar userType=localStorage.getItem(\"role\");useEffect(function(){getLevels();getTopSellers();Stocktake();getTopSellersAllTime();},[]);return userType===\"User\"?/*#__PURE__*/React.createElement(Redirect,{to:\"/userdashboard\"}):/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"main\",{role:\"main\",className:\"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"h2\"},\"Welcome back, \",name,\"!\"),/*#__PURE__*/React.createElement(\"div\",{className:\"btn-toolbar mb-2 mb-md-0\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},_.isEmpty(graphLabels)||_.isEmpty(graphData)?/*#__PURE__*/React.createElement(\"div\",null,\"Loading\"):/*#__PURE__*/React.createElement(TopSellerChart,{weekData:graphData,weekLabels:graphLabels,allTimeData:allTimeData,allTimeLabels:allTimeLabels})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},_.isEmpty(levels)?/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\"):/*#__PURE__*/React.createElement(ProductAlerts,{levels:levels}))),/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},/*#__PURE__*/React.createElement(StockRecords,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-6\"},/*#__PURE__*/React.createElement(DashBoardStocktaking,{stocktake:stocktake})))))));};export default Dashboard;","map":{"version":3,"sources":["C:/Users/alans/bevstock/client/src/components/Dashboard.js"],"names":["React","Fragment","useState","useEffect","Redirect","TopSellerChart","ProductAlerts","DashBoardStocktaking","StockRecords","_","Dashboard","setAuth","name","stocktake","setStocktake","predictedOrder","setPredictedOrder","levels","setLevels","graphLabels","setGraphLabels","graphData","setGraphData","allTimeLabels","setAllTimeLabels","allTimeData","setAllTimeData","stockId","Number","localStorage","getItem","Stocktake","getPredictedOrder","map","item","product_name","sum","avg_weekly_sales","par_level","getLevels","fetch","method","headers","token","response","json","parseRes","console","log","message","getTopSellers","product","sales","getTopSellersAllTime","getPermission","Notification","requestPermission","then","result","userType","isEmpty"],"mappings":"udAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,QAA1B,CAAoCC,SAApC,KAAqD,OAArD,CACA,OAASC,QAAT,KAAyB,kBAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,8BAA3B,CACA,MAAOC,CAAAA,aAAP,KAA0B,uCAA1B,CACA,MAAOC,CAAAA,oBAAP,KAAiC,wBAAjC,CACA,MAAOC,CAAAA,YAAP,KAAyB,0BAAzB,CACA,MAAOC,CAAAA,CAAP,KAAc,QAAd,CAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,MAAuB,IAApBC,CAAAA,OAAoB,MAApBA,OAAoB,CAAXC,IAAW,MAAXA,IAAW,eACLV,QAAQ,CAAC,KAAD,CADH,wCAChCW,SADgC,eACrBC,YADqB,8BAEKZ,QAAQ,CAAC,EAAD,CAFb,yCAEhCa,cAFgC,eAEhBC,iBAFgB,8BAGXd,QAAQ,CAAC,EAAD,CAHG,yCAGhCe,MAHgC,eAGxBC,SAHwB,8BAIDhB,QAAQ,CAAC,EAAD,CAJP,yCAIhCiB,WAJgC,eAInBC,cAJmB,8BAKLlB,QAAQ,CAAC,EAAD,CALH,0CAKhCmB,SALgC,gBAKrBC,YALqB,gCAMGpB,QAAQ,CAAC,EAAD,CANX,2CAMhCqB,aANgC,gBAMjBC,gBANiB,gCAODtB,QAAQ,CAAC,EAAD,CAPP,2CAOhCuB,WAPgC,gBAOnBC,cAPmB,gBASvC;AACA,GAAMC,CAAAA,OAAO,CAAGC,MAAM,CAACC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAD,CAAtB,CAEA;AACA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtB,GAAIJ,OAAO,GAAK,CAAhB,CAAmB,CACjBb,YAAY,CAAC,IAAD,CAAZ,CACD,CACF,CAJD,CAMA,GAAMkB,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACf,MAAD,CAAY,CACpCD,iBAAiB,CACfC,MAAM,CAACgB,GAAP,CAAW,SAACC,IAAD,CAAU,CACnB,MAAO,CACLtB,IAAI,CAAEsB,IAAI,CAACC,YADN,CAELpB,cAAc,CAAEa,MAAM,CACpBA,MAAM,CAACM,IAAI,CAACE,GAAN,CAAN,CAAmBF,IAAI,CAACG,gBAAxB,CAA2CH,IAAI,CAACI,SAD5B,CAFjB,CAAP,CAMD,CAPD,CADe,CAAjB,CAUD,CAXD,CAaA;AACA,GAAMC,CAAAA,SAAS,2FAAG,+LAESC,CAAAA,KAAK,6BACLX,YAAY,CAACC,OAAb,CACnB,eADmB,CADK,EAI1B,CACEW,MAAM,CAAE,KADV,CAEEC,OAAO,CAAE,CAAEC,KAAK,CAAEd,YAAY,CAACc,KAAtB,CAFX,CAJ0B,CAFd,QAERC,QAFQ,qCAWSA,CAAAA,QAAQ,CAACC,IAAT,EAXT,QAWRC,QAXQ,eAYd5B,SAAS,CAAC4B,QAAD,CAAT,CAZc,iFAcdC,OAAO,CAACC,GAAR,CAAY,YAAIC,OAAhB,EAdc,qEAAH,kBAATV,CAAAA,SAAS,2CAAf,CAkBA;AACA,GAAMW,CAAAA,aAAa,2FAAG,sMAEKV,CAAAA,KAAK,iCACDX,YAAY,CAACC,OAAb,CACvB,eADuB,CADC,EAI1B,CACEW,MAAM,CAAE,KADV,CAEEC,OAAO,CAAE,CAAEC,KAAK,CAAEd,YAAY,CAACc,KAAtB,CAFX,CAJ0B,CAFV,QAEZC,QAFY,uCAWKA,CAAAA,QAAQ,CAACC,IAAT,EAXL,QAWZC,QAXY,gBAYlB1B,cAAc,CACZ0B,QAAQ,CAACb,GAAT,CAAa,SAACkB,OAAD,CAAa,CACxB,MAAOA,CAAAA,OAAO,CAAChB,YAAf,CACD,CAFD,CADY,CAAd,CAKAb,YAAY,CACVwB,QAAQ,CAACb,GAAT,CAAa,SAACkB,OAAD,CAAa,CACxB,MAAOA,CAAAA,OAAO,CAACC,KAAf,CACD,CAFD,CADU,CAAZ,CAjBkB,qFAuBlBL,OAAO,CAACC,GAAR,CAAY,aAAMC,OAAlB,EAvBkB,uEAAH,kBAAbC,CAAAA,aAAa,2CAAnB,CA2BA;AACA,GAAMG,CAAAA,oBAAoB,2FAAG,sMAEFb,CAAAA,KAAK,iCAE1B,CACEC,MAAM,CAAE,KADV,CAEEC,OAAO,CAAE,CAAEC,KAAK,CAAEd,YAAY,CAACc,KAAtB,CAFX,CAF0B,CAFH,QAEnBC,QAFmB,uCASFA,CAAAA,QAAQ,CAACC,IAAT,EATE,QASnBC,QATmB,gBAUzBtB,gBAAgB,CACdsB,QAAQ,CAACb,GAAT,CAAa,SAACkB,OAAD,CAAa,CACxB,MAAOA,CAAAA,OAAO,CAAChB,YAAf,CACD,CAFD,CADc,CAAhB,CAKAT,cAAc,CACZoB,QAAQ,CAACb,GAAT,CAAa,SAACkB,OAAD,CAAa,CACxB,MAAOA,CAAAA,OAAO,CAACf,GAAf,CACD,CAFD,CADY,CAAd,CAfyB,qFAqBzBW,OAAO,CAACC,GAAR,CAAY,aAAMC,OAAlB,EArByB,uEAAH,kBAApBI,CAAAA,oBAAoB,2CAA1B,CAyBA,GAAMC,CAAAA,aAAa,2FAAG,wIACpBC,YAAY,CAACC,iBAAb,GAAiCC,IAAjC,CAAsC,SAAUC,MAAV,CAAkB,CACtDX,OAAO,CAACC,GAAR,CAAYU,MAAZ,EACD,CAFD,EADoB,wDAAH,kBAAbJ,CAAAA,aAAa,2CAAnB,CAMA;AACA,GAAMK,CAAAA,QAAQ,CAAG9B,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAjB,CAEA3B,SAAS,CAAC,UAAM,CACdoC,SAAS,GACTW,aAAa,GACbnB,SAAS,GACTsB,oBAAoB,GACrB,CALQ,CAKN,EALM,CAAT,CAOA,MAAOM,CAAAA,QAAQ,GAAK,MAAb,cACL,oBAAC,QAAD,EAAU,EAAE,CAAC,gBAAb,EADK,cAGL,oBAAC,QAAD,mBACE,2BAAK,SAAS,CAAC,iBAAf,eACE,2BAAK,SAAS,CAAC,KAAf,eACE,4BAAM,IAAI,CAAC,MAAX,CAAkB,SAAS,CAAC,yCAA5B,eACE,2BAAK,SAAS,CAAC,oGAAf,eACE,0BAAI,SAAS,CAAC,IAAd,mBAAkC/C,IAAlC,KADF,cAEE,2BAAK,SAAS,CAAC,0BAAf,EAFF,CADF,cAME,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,EACGH,CAAC,CAACmD,OAAF,CAAUzC,WAAV,GAA0BV,CAAC,CAACmD,OAAF,CAAUvC,SAAV,CAA1B,cACC,yCADD,cAGC,oBAAC,cAAD,EACE,QAAQ,CAAEA,SADZ,CAEE,UAAU,CAAEF,WAFd,CAGE,WAAW,CAAEM,WAHf,CAIE,aAAa,CAAEF,aAJjB,EAJJ,CADF,cAaE,2BAAK,SAAS,CAAC,UAAf,EACGd,CAAC,CAACmD,OAAF,CAAU3C,MAAV,eACC,4CADD,cAGC,oBAAC,aAAD,EAAe,MAAM,CAAEA,MAAvB,EAJJ,CAbF,CANF,cA2BE,2BAAK,SAAS,CAAC,KAAf,eACE,2BAAK,SAAS,CAAC,UAAf,eACE,oBAAC,YAAD,MADF,CADF,cAIE,2BAAK,SAAS,CAAC,UAAf,eACE,oBAAC,oBAAD,EAAsB,SAAS,CAAEJ,SAAjC,EADF,CAJF,CA3BF,CADF,CADF,CADF,CAHF,CA8CD,CAvKD,CAyKA,cAAeH,CAAAA,SAAf","sourcesContent":["import React, { Fragment, useState, useEffect } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport TopSellerChart from \"../components/TopSellerChart\";\r\nimport ProductAlerts from \"../components/inventory/ProductAlerts\";\r\nimport DashBoardStocktaking from \"./DashboardStocktaking\";\r\nimport StockRecords from \"./inventory/StockRecords\";\r\nimport _ from \"lodash\";\r\n\r\nconst Dashboard = ({ setAuth, name }) => {\r\n  const [stocktake, setStocktake] = useState(false);\r\n  const [predictedOrder, setPredictedOrder] = useState([]);\r\n  const [levels, setLevels] = useState([]);\r\n  const [graphLabels, setGraphLabels] = useState([]);\r\n  const [graphData, setGraphData] = useState([]);\r\n  const [allTimeLabels, setAllTimeLabels] = useState([]);\r\n  const [allTimeData, setAllTimeData] = useState([]);\r\n\r\n  //get id of stocktake if stocktake in progress\r\n  const stockId = Number(localStorage.getItem(\"stocktake\"));\r\n\r\n  //if stock ID exists, set stocktake to true.\r\n  const Stocktake = () => {\r\n    if (stockId !== 0) {\r\n      setStocktake(true);\r\n    }\r\n  };\r\n\r\n  const getPredictedOrder = (levels) => {\r\n    setPredictedOrder(\r\n      levels.map((item) => {\r\n        return {\r\n          name: item.product_name,\r\n          predictedOrder: Number(\r\n            Number(item.sum) - item.avg_weekly_sales + item.par_level\r\n          ),\r\n        };\r\n      })\r\n    );\r\n  };\r\n\r\n  //find levels with pars for product alerts components.\r\n  const getLevels = async () => {\r\n    try {\r\n      const response = await fetch(\r\n        `/inventory/levels/${localStorage.getItem(\r\n          \"laststocktake\"\r\n        )}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n      const parseRes = await response.json();\r\n      setLevels(parseRes);\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  };\r\n\r\n  //get top selling products for chart (week)\r\n  const getTopSellers = async () => {\r\n    try {\r\n      const response = await fetch(\r\n        `/inventory/topsellers/${localStorage.getItem(\r\n          \"laststocktake\"\r\n        )}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n      const parseRes = await response.json();\r\n      setGraphLabels(\r\n        parseRes.map((product) => {\r\n          return product.product_name;\r\n        })\r\n      );\r\n      setGraphData(\r\n        parseRes.map((product) => {\r\n          return product.sales;\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.log(error.message);\r\n    }\r\n  };\r\n\r\n  //get top selling products for chart (all time)\r\n  const getTopSellersAllTime = async () => {\r\n    try {\r\n      const response = await fetch(\r\n        `/inventory/alltimetopsellers/`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n      const parseRes = await response.json();\r\n      setAllTimeLabels(\r\n        parseRes.map((product) => {\r\n          return product.product_name;\r\n        })\r\n      );\r\n      setAllTimeData(\r\n        parseRes.map((product) => {\r\n          return product.sum;\r\n        })\r\n      );\r\n    } catch (error) {\r\n      console.log(error.message);\r\n    }\r\n  };\r\n\r\n  const getPermission = async () => {\r\n    Notification.requestPermission().then(function (result) {\r\n      console.log(result);\r\n    });\r\n  };\r\n\r\n  //get userType for conditional render\r\n  const userType = localStorage.getItem(\"role\");\r\n\r\n  useEffect(() => {\r\n    getLevels();\r\n    getTopSellers();\r\n    Stocktake();\r\n    getTopSellersAllTime();\r\n  }, []);\r\n\r\n  return userType === \"User\" ? (\r\n    <Redirect to=\"/userdashboard\" />\r\n  ) : (\r\n    <Fragment>\r\n      <div className=\"container-fluid\">\r\n        <div className=\"row\">\r\n          <main role=\"main\" className=\"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\">\r\n            <div className=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom\">\r\n              <h1 className=\"h2\">Welcome back, {name}!</h1>\r\n              <div className=\"btn-toolbar mb-2 mb-md-0\"></div>\r\n            </div>\r\n\r\n            <div className=\"row\">\r\n              <div className=\"col-md-6\">\r\n                {_.isEmpty(graphLabels) || _.isEmpty(graphData) ? (\r\n                  <div>Loading</div>\r\n                ) : (\r\n                  <TopSellerChart\r\n                    weekData={graphData}\r\n                    weekLabels={graphLabels}\r\n                    allTimeData={allTimeData}\r\n                    allTimeLabels={allTimeLabels}\r\n                  />\r\n                )}\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                {_.isEmpty(levels) ? (\r\n                  <div>Loading...</div>\r\n                ) : (\r\n                  <ProductAlerts levels={levels} />\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"row\">\r\n              <div className=\"col-md-6\">\r\n                <StockRecords />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <DashBoardStocktaking stocktake={stocktake} />\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}