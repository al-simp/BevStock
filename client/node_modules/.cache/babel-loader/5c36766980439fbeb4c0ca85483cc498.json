{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{Fragment,useState,useEffect}from\"react\";import{Link}from\"react-router-dom\";import _ from\"lodash\";var UserDashboard=function UserDashboard(_ref){var setAuth=_ref.setAuth;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),stocktake=_useState4[0],setStocktake=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),hasDuties=_useState6[0],setHasDuties=_useState6[1];function checkStocktake(){return _checkStocktake.apply(this,arguments);}function _checkStocktake(){_checkStocktake=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"/stocktake/activestocktake\",{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context.sent;_context.next=6;return response.json();case 6:parseRes=_context.sent;if(parseRes.length>0){setStocktake(parseRes);localStorage.setItem(\"stocktake\",parseRes[0].stocktake_id);localStorage.setItem(\"stocktakedate\",parseRes[0].stocktake_date);}else{console.log(\"no stocktake in progress\");}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.error(_context.t0.message);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return _checkStocktake.apply(this,arguments);}function getDuties(){return _getDuties.apply(this,arguments);}function _getDuties(){_getDuties=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"/dashboard/duties\",{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:parseRes=_context2.sent;if(parseRes.length>0){setHasDuties(true);}console.log(parseRes);_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0.message);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));return _getDuties.apply(this,arguments);}function getName(){return _getName.apply(this,arguments);}function _getName(){_getName=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response,parseRes;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"/dashboard/\",{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:parseRes=_context3.sent;console.log(parseRes);localStorage.setItem(\"user\",parseRes.user_id);setName(parseRes.user_name);_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0.message);case 15:console.log(name);case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,12]]);}));return _getName.apply(this,arguments);}var logout=function logout(e){e.preventDefault();localStorage.clear();setAuth(false);};//check if user has been assigned any stocktake duties\nuseEffect(function(){getDuties();getName();checkStocktake();},[]);return/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(\"main\",{role:\"main\"},/*#__PURE__*/React.createElement(\"div\",{className:\"jumbotron\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary float-right\",onClick:function onClick(e){return logout(e);}},\"Logout\"),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"display-3\"},\"Hello, \",name,\"!\"),/*#__PURE__*/React.createElement(\"p\",null,\"Welcome to your BevStock user dashboard.\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-4\"},/*#__PURE__*/React.createElement(\"h2\",null,\"Stocktaking\"),!_.isEmpty(stocktake)?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",null,\"Stocktake in progress :\",\" \",localStorage.getItem(\"stocktakedate\")),hasDuties?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",null,\"You have been assigned stocktaking duties\"),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(Link,{className:\"btn btn-secondary\",to:\"/userstocktaking\"},\"View\"))):/*#__PURE__*/React.createElement(\"p\",null,\"You haven't been assigned any stocktakting duties\")):/*#__PURE__*/React.createElement(\"p\",null,\"No stocktake in progress\"))))));};export default UserDashboard;","map":{"version":3,"sources":["C:/Users/alans/bevstock/client/src/user/UserDashboard.js"],"names":["React","Fragment","useState","useEffect","Link","_","UserDashboard","setAuth","name","setName","stocktake","setStocktake","hasDuties","setHasDuties","checkStocktake","fetch","method","headers","token","localStorage","response","json","parseRes","length","setItem","stocktake_id","stocktake_date","console","log","error","message","getDuties","getName","user_id","user_name","logout","e","preventDefault","clear","isEmpty","getItem"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport _ from \"lodash\";\r\n\r\nconst UserDashboard = ({ setAuth }) => {\r\n  const [name, setName] = useState(\"\");\r\n  const [stocktake, setStocktake] = useState({});\r\n  const [hasDuties, setHasDuties] = useState(false);\r\n\r\n  async function checkStocktake() {\r\n    try {\r\n      const response = await fetch(\r\n        \"/stocktake/activestocktake\",\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n\r\n      const parseRes = await response.json();\r\n\r\n      if (parseRes.length > 0) {\r\n        setStocktake(parseRes);\r\n        localStorage.setItem(\"stocktake\", parseRes[0].stocktake_id);\r\n        localStorage.setItem(\"stocktakedate\", parseRes[0].stocktake_date);\r\n      } else {\r\n        console.log(\"no stocktake in progress\");\r\n      }\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  async function getDuties() {\r\n    try {\r\n      const response = await fetch(\"/dashboard/duties\", {\r\n        method: \"GET\",\r\n        headers: { token: localStorage.token },\r\n      });\r\n\r\n      const parseRes = await response.json();\r\n\r\n      if (parseRes.length > 0) {\r\n        setHasDuties(true);\r\n      }\r\n      console.log(parseRes);\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  }\r\n\r\n  async function getName() {\r\n    try {\r\n      const response = await fetch(\"/dashboard/\", {\r\n        method: \"GET\",\r\n        headers: { token: localStorage.token },\r\n      });\r\n\r\n      const parseRes = await response.json();\r\n\r\n      console.log(parseRes);\r\n      localStorage.setItem(\"user\", parseRes.user_id);\r\n      setName(parseRes.user_name);\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n    console.log(name);\r\n  }\r\n\r\n  const logout = (e) => {\r\n    e.preventDefault();\r\n    localStorage.clear();\r\n    setAuth(false);\r\n  };\r\n\r\n  //check if user has been assigned any stocktake duties\r\n\r\n  useEffect(() => {\r\n    getDuties();\r\n    getName();\r\n    checkStocktake();\r\n  }, []);\r\n\r\n  return (\r\n    <Fragment>\r\n      <main role=\"main\">\r\n        <div className=\"jumbotron\">\r\n          <button\r\n            className=\"btn btn-primary float-right\"\r\n            onClick={(e) => logout(e)}\r\n          >\r\n            Logout\r\n          </button>\r\n          <div className=\"container\">\r\n            <h1 className=\"display-3\">Hello, {name}!</h1>\r\n            <p>Welcome to your BevStock user dashboard.</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"container\">\r\n          <div className=\"row\">\r\n            <div className=\"col-md-4\">\r\n              <h2>Stocktaking</h2>\r\n              {!_.isEmpty(stocktake) ? (\r\n                <div>\r\n                  <p>\r\n                    Stocktake in progress :{\" \"}\r\n                    {localStorage.getItem(\"stocktakedate\")}\r\n                  </p>\r\n                  {hasDuties ? (\r\n                    <div>\r\n                      <p>You have been assigned stocktaking duties</p>\r\n                      <p>\r\n                        <Link\r\n                          className=\"btn btn-secondary\"\r\n                          to=\"/userstocktaking\"\r\n                        >\r\n                          View\r\n                        </Link>\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <p>You haven't been assigned any stocktakting duties</p>\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <p>No stocktake in progress</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default UserDashboard;\r\n"]},"metadata":{},"sourceType":"module"}