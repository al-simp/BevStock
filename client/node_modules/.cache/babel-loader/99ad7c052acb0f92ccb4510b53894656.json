{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{Fragment,useState,useEffect,useRef}from\"react\";import Dropdown from\"./Dropdown\";import Product from\"./Product\";import\"../../../src/App.css\";import{toast}from\"react-toastify\";var ViewEdit=function ViewEdit(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),products=_useState4[0],setProducts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),productsChange=_useState6[0],setProductsChange=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),dragging=_useState8[0],setDragging=_useState8[1];var dragItem=useRef();var dragNode=useRef();var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),dragMode=_useState10[0],setDragMode=_useState10[1];var id=props.match.params.id;//handle drag start\nvar handleDragStart=function handleDragStart(e,params){// set current item being dragged\ndragItem.current=params;dragNode.current=e.target;//Initialise drag end listener\ndragNode.current.addEventListener(\"dragend\",handleDragEnd);// Intialise drag enter listener\nsetTimeout(function(){setDragging(true);},0);};var handleDragEnter=function handleDragEnter(e,params){//check that index of current item is not the same as target location.\nif(dragItem.current!==params.productI){// use setProducts hook to set state to newly arranged array.\nsetProducts(function(oldProducts){var newList=JSON.parse(JSON.stringify(oldProducts));newList.splice(params.productI,0,newList.splice(dragItem.current.productI,1)[0]);dragItem.current=params;return newList;});}};//the handle drag end listener.\nvar handleDragEnd=function handleDragEnd(){setDragging(false);dragNode.current.removeEventListener(\"dragend\",handleDragEnd);dragItem.current=null;dragNode.current=null;};//set the positions in the DB\nfunction setPosition(_x,_x2){return _setPosition.apply(this,arguments);}//set the positions of each element in the database under index column\nfunction _setPosition(){_setPosition=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id,productI){var body,response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;body={id:id,productI:productI};_context4.next=4;return fetch(\"/stocklists/savepositions\",{method:\"POST\",headers:{\"Content-type\":\"application/json\"},body:JSON.stringify(body)});case 4:response=_context4.sent;_context4.next=7;return response.json;case 7:_context4.next=12;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](0);console.error(_context4.t0.message);case 12:case\"end\":return _context4.stop();}}},_callee4,null,[[0,9]]);}));return _setPosition.apply(this,arguments);}function setPositions(){return _setPositions.apply(this,arguments);}function _setPositions(){_setPositions=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(dragMode){products.map(function(product,productI){setPosition(product.product_stocklist_id,productI);return null;});setDragMode(false);toast.success(\"Positions updated\");}else{setDragMode(true);}case 1:case\"end\":return _context5.stop();}}},_callee5);}));return _setPositions.apply(this,arguments);}var getStyles=function getStyles(params){var currentItem=dragItem.current;if(currentItem.productI===params){return\"current dnd-item\";}return\"dnd-item\";};//get list name\nvar getName=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var response,parseRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"/stocklists/get/\".concat(id),{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context.sent;_context.next=6;return response.json();case 6:parseRes=_context.sent;setName(parseRes.rows[0].stocklist_name);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.error(_context.t0.message);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function getName(_x3){return _ref.apply(this,arguments);};}();//get products on list\nvar getProducts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var response,parseRes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"/stocklists/list/\".concat(id),{method:\"GET\",headers:{token:localStorage.token}});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:parseRes=_context2.sent;setProducts(parseRes);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0.message);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function getProducts(_x4){return _ref2.apply(this,arguments);};}();//delete a product from list\nvar deleteProduct=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"/stocklists/deleteproduct/\".concat(id),{method:\"DELETE\",headers:{token:localStorage.token}});case 3:_context3.next=8;break;case 5:_context3.prev=5;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0.message);case 8:setProductsChange(true);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,5]]);}));return function deleteProduct(_x5){return _ref3.apply(this,arguments);};}();useEffect(function(){getName(props.match.params.id);getProducts(props.match.params.id);setProductsChange(false);},[productsChange]);return/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"container-fluid\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\"},/*#__PURE__*/React.createElement(\"main\",{role:\"main\",className:\"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"jumbotron\"},/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"display-3\"},name),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary float-right\",onClick:setPositions},dragMode?\"Save Positions\":\"Change List Order\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Dropdown,{listId:id,setProductsChange:setProductsChange})))),/*#__PURE__*/React.createElement(\"table\",{className:\"table mt-5 text-center\"},/*#__PURE__*/React.createElement(\"thead\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"th\",null,\"Product\"),dragMode?null:/*#__PURE__*/React.createElement(\"th\",null,\"Delete\"))),dragMode?/*#__PURE__*/React.createElement(\"tbody\",null,products.map(function(product,productI){return/*#__PURE__*/React.createElement(\"tr\",{draggable:true,onDragStart:function onDragStart(e){handleDragStart(e,{productI:productI});},onDragEnter:dragging?function(e){handleDragEnter(e,{productI:productI});}:null,key:product.product_stocklist_id,className:dragging?getStyles(productI):\"dnd-item\"},/*#__PURE__*/React.createElement(Product,{key:product.product_stocklist_id,name:product.product_name,id:product.product_stocklist_id}));})):/*#__PURE__*/React.createElement(\"tbody\",null,products.map(function(product){return/*#__PURE__*/React.createElement(\"tr\",{key:product.product_stocklist_id},/*#__PURE__*/React.createElement(\"td\",null,product.product_name),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-danger\",onClick:function onClick(e){return deleteProduct(product.product_stocklist_id);}},\"Delete\")));})))))));};export default ViewEdit;","map":{"version":3,"sources":["C:/Users/alans/bevstock/client/src/components/stocktaking/ViewEdit.js"],"names":["React","Fragment","useState","useEffect","useRef","Dropdown","Product","toast","ViewEdit","props","name","setName","products","setProducts","productsChange","setProductsChange","dragging","setDragging","dragItem","dragNode","dragMode","setDragMode","id","match","params","handleDragStart","e","current","target","addEventListener","handleDragEnd","setTimeout","handleDragEnter","productI","oldProducts","newList","JSON","parse","stringify","splice","removeEventListener","setPosition","body","fetch","method","headers","response","json","console","error","message","setPositions","map","product","product_stocklist_id","success","getStyles","currentItem","getName","token","localStorage","parseRes","rows","stocklist_name","getProducts","deleteProduct","product_name"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect, useRef } from \"react\";\r\nimport Dropdown from \"./Dropdown\";\r\nimport Product from \"./Product\";\r\nimport \"../../../src/App.css\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst ViewEdit = (props) => {\r\n  const [name, setName] = useState([]);\r\n  const [products, setProducts] = useState([]);\r\n  const [productsChange, setProductsChange] = useState(false);\r\n  const [dragging, setDragging] = useState(false);\r\n\r\n  const dragItem = useRef();\r\n  const dragNode = useRef();\r\n\r\n  const [dragMode, setDragMode] = useState(false);\r\n\r\n  const id = props.match.params.id;\r\n\r\n  //handle drag start\r\n  const handleDragStart = (e, params) => {\r\n    // set current item being dragged\r\n    dragItem.current = params;\r\n    dragNode.current = e.target;\r\n    //Initialise drag end listener\r\n    dragNode.current.addEventListener(\"dragend\", handleDragEnd);\r\n    // Intialise drag enter listener\r\n    setTimeout(() => {\r\n      setDragging(true);\r\n    }, 0);\r\n  };\r\n\r\n  const handleDragEnter = (e, params) => {\r\n    //check that index of current item is not the same as target location.\r\n    if (dragItem.current !== params.productI) {\r\n      // use setProducts hook to set state to newly arranged array.\r\n      setProducts((oldProducts) => {\r\n        let newList = JSON.parse(JSON.stringify(oldProducts));\r\n        newList.splice(\r\n          params.productI,\r\n          0,\r\n          newList.splice(dragItem.current.productI, 1)[0]\r\n        );\r\n        dragItem.current = params;\r\n        return newList;\r\n      });\r\n    }\r\n  };\r\n\r\n  //the handle drag end listener.\r\n  const handleDragEnd = () => {\r\n    setDragging(false);\r\n    dragNode.current.removeEventListener(\"dragend\", handleDragEnd);\r\n    dragItem.current = null;\r\n    dragNode.current = null;\r\n  };\r\n\r\n  //set the positions in the DB\r\n  async function setPosition(id, productI) {\r\n    try {\r\n      const body = { id, productI };\r\n      const response = await fetch(\r\n        `/stocklists/savepositions`,\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-type\": \"application/json\" },\r\n          body: JSON.stringify(body),\r\n        }\r\n      );\r\n      await response.json;\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  //set the positions of each element in the database under index column\r\n  async function setPositions() {\r\n    if (dragMode) {\r\n      products.map((product, productI) => {\r\n        setPosition(product.product_stocklist_id, productI);\r\n        return null;\r\n      });\r\n      setDragMode(false);\r\n      toast.success(\"Positions updated\");\r\n    } else {\r\n      setDragMode(true);\r\n    }\r\n  }\r\n\r\n  const getStyles = (params) => {\r\n    const currentItem = dragItem.current;\r\n    if (currentItem.productI === params) {\r\n      return \"current dnd-item\";\r\n    }\r\n    return \"dnd-item\";\r\n  };\r\n\r\n  //get list name\r\n  const getName = async (id) => {\r\n    try {\r\n      const response = await fetch(\r\n        `/stocklists/get/${id}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n\r\n      const parseRes = await response.json();\r\n\r\n      setName(parseRes.rows[0].stocklist_name);\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n  };\r\n\r\n  //get products on list\r\n  const getProducts = async (id) => {\r\n    try {\r\n      const response = await fetch(\r\n        `/stocklists/list/${id}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n\r\n      const parseRes = await response.json();\r\n\r\n      setProducts(parseRes);\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n  };\r\n\r\n  //delete a product from list\r\n  const deleteProduct = async (id) => {\r\n    try {\r\n      await fetch(`/stocklists/deleteproduct/${id}`, {\r\n        method: \"DELETE\",\r\n        headers: { token: localStorage.token },\r\n      });\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n\r\n    setProductsChange(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    getName(props.match.params.id);\r\n    getProducts(props.match.params.id);\r\n    setProductsChange(false);\r\n  }, [productsChange]);\r\n\r\n  return (\r\n    <Fragment>\r\n      <div className=\"container-fluid\">\r\n        <div className=\"row\">\r\n          <main role=\"main\" className=\"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\">\r\n            <div className=\"jumbotron\">\r\n              <div className=\"container\">\r\n                <h1 className=\"display-3\">{name}</h1>\r\n                <button\r\n                  className=\"btn btn-primary float-right\"\r\n                  onClick={setPositions}\r\n                >\r\n                  {dragMode ? \"Save Positions\" : \"Change List Order\"}\r\n                </button>\r\n                <div>\r\n                  <Dropdown listId={id} setProductsChange={setProductsChange} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <table className=\"table mt-5 text-center\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Product</th>\r\n                  {dragMode ? null : <th>Delete</th>}\r\n                </tr>\r\n              </thead>\r\n              {dragMode ? (\r\n                <tbody>\r\n                  {products.map((product, productI) => (\r\n                    <tr\r\n                      draggable\r\n                      onDragStart={(e) => {\r\n                        handleDragStart(e, { productI });\r\n                      }}\r\n                      onDragEnter={\r\n                        dragging\r\n                          ? (e) => {\r\n                              handleDragEnter(e, { productI });\r\n                            }\r\n                          : null\r\n                      }\r\n                      key={product.product_stocklist_id}\r\n                      className={dragging ? getStyles(productI) : \"dnd-item\"}\r\n                    >\r\n                      <Product\r\n                        key={product.product_stocklist_id}\r\n                        name={product.product_name}\r\n                        id={product.product_stocklist_id}\r\n                      />\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              ) : (\r\n                <tbody>\r\n                  {products.map((product) => (\r\n                    <tr key={product.product_stocklist_id}>\r\n                      <td>{product.product_name}</td>\r\n                      <td>\r\n                        <button\r\n                          className=\"btn btn-danger\"\r\n                          onClick={(e) =>\r\n                            deleteProduct(product.product_stocklist_id)\r\n                          }\r\n                        >\r\n                          Delete\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              )}\r\n            </table>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default ViewEdit;\r\n"]},"metadata":{},"sourceType":"module"}