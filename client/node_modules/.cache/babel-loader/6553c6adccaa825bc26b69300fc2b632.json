{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\alans\\\\bevstock\\\\client\\\\src\\\\components\\\\Dashboard.js\";\nimport React, { Fragment, useState, useEffect } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { FaBeer } from \"react-icons/fa\";\nimport { AiOutlineHome } from \"react-icons/ai\";\nimport { MdLocalBar } from \"react-icons/md\";\nimport { RiScales2Fill } from \"react-icons/ri\";\nimport { BsCardChecklist } from \"react-icons/bs\";\nimport TopSellerChart from \"../components/TopSellerChart\";\nimport ProductAlerts from \"../components/inventory/ProductAlerts\";\nimport { toast } from \"react-toastify\";\nimport DashBoardStocktaking from \"./DashboardStocktaking\";\nimport StockRecords from \"./inventory/StockRecords\";\n\nconst Dashboard = ({\n  setAuth\n}) => {\n  const [name, setName] = useState(\"\");\n  const [stocktake, setStocktake] = useState(false);\n  const [latestInventoryDate, setLatestInventoryDate] = useState(\"\");\n  const [latestInventoryId, setLatestInventoryId] = useState(\"\");\n  const [previousInventory, setPreviousInventory] = useState(\"\");\n  const [products, setProducts] = useState([]);\n  const [levels, setLevels] = useState([]);\n\n  async function getSalesData() {\n    try {\n      const response = await fetch(\"http://localhost:5000/products/get/distinct\", {\n        method: \"GET\",\n        headers: {\n          token: localStorage.token\n        }\n      });\n      const parseRes = await response.json();\n      console.log(parseRes);\n      setProducts(parseRes);\n    } catch (error) {\n      console.error(error.message);\n    }\n  }\n\n  async function checkStocktake() {\n    try {\n      const response = await fetch(\"http://localhost:5000/stocktake/activestocktake\", {\n        method: \"GET\",\n        headers: {\n          token: localStorage.token\n        }\n      });\n      const parseRes = await response.json();\n\n      if (parseRes.length > 0) {\n        setStocktake(parseRes);\n        localStorage.setItem(\"stocktake\", parseRes[0].stocktake_id);\n        localStorage.setItem(\"stocktakedate\", parseRes[0].stocktake_date);\n      } else {\n        console.log(\"no stocktake in progress\");\n      }\n    } catch (error) {\n      console.error(error.message);\n    }\n  }\n\n  const stockId = Number(localStorage.getItem(\"stocktake\"));\n  const userType = localStorage.getItem(\"role\");\n\n  const Stocktake = () => {\n    if (stockId !== 0) {\n      console.log(\"stocktake in progress\");\n      setStocktake(true);\n    }\n  };\n\n  async function findLastStocktake() {\n    try {\n      const response = await fetch(\"http://localhost:5000/inventory/latest\", {\n        method: \"GET\",\n        headers: {\n          token: localStorage.token\n        }\n      });\n      const parseRes = await response.json();\n      setLatestInventoryDate(parseRes[0].stocktake_date);\n      setLatestInventoryId(parseRes[0].stocktake_id);\n      setPreviousInventory(parseRes[1].stocktake_id);\n      console.log(latestInventoryDate);\n    } catch (error) {\n      console.error(error.message);\n    }\n  }\n\n  async function getName() {\n    try {\n      const response = await fetch(\"http://localhost:5000/dashboard/\", {\n        method: \"GET\",\n        headers: {\n          token: localStorage.token\n        }\n      });\n      const parseRes = await response.json();\n      setName(parseRes.user_name);\n      console.log(userType);\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n\n  async function getLevels() {\n    try {\n      const response = await fetch(`http://localhost:5000/inventory/levels/${latestInventoryId}`, {\n        method: \"GET\",\n        headers: {\n          token: localStorage.token\n        }\n      });\n      const parseRes = await response.json();\n      console.log(parseRes);\n      setLevels(parseRes);\n    } catch (err) {\n      console.log(err.message);\n    }\n  }\n\n  const logout = e => {\n    e.preventDefault();\n    localStorage.clear();\n    setAuth(false);\n    toast.success(\"Logged out succsessfully!\");\n  };\n\n  useEffect(() => {\n    findLastStocktake();\n    checkStocktake();\n    Stocktake();\n    getName();\n    getSalesData();\n\n    if (latestInventoryId !== \"\") {\n      getLevels();\n    }\n  }, [latestInventoryId]);\n  return userType == \"User\" ? /*#__PURE__*/React.createElement(Redirect, {\n    to: \"/userdashboard\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 5\n    }\n  }) : /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"nav\", {\n    className: \"navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    className: \"navbar-brand col-sm-3 col-md-2 mr-0\",\n    href: \"#\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, \"BevStock\"), /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"navbar-nav px-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item text-nowrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    className: \"nav-link\",\n    onClick: e => logout(e),\n    href: \"#\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }, name, \" : Sign out\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"nav\", {\n    className: \"col-md-2 d-none d-md-block bg-light sidebar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sidebar-sticky\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"nav flex-column\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    className: \"nav-link active\",\n    href: \"#\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(AiOutlineHome, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 21\n    }\n  }), \" Dashboard\", \" \", /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 21\n    }\n  }, \"(current)\"))), /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    className: \"nav-item nav-link\",\n    to: \"/stocktaking\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(MdLocalBar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 21\n    }\n  }), \" View/Edit Stock Areas\")), /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/stocktakelists\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(RiScales2Fill, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 21\n    }\n  }), stocktake ? \"  Continue Stocktake\" : \"  Perform a Stocktake\")), /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    className: \"nav-link\",\n    to: `/inventory/${latestInventoryId}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(BsCardChecklist, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 21\n    }\n  }), \" Inventory\")), /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"li\", {\n    className: \"nav-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    className: \"nav-link\",\n    href: \"#\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    \"data-feather\": \"layers\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 21\n    }\n  }), \"Integrations\"))))), /*#__PURE__*/React.createElement(\"main\", {\n    role: \"main\",\n    className: \"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"h2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 15\n    }\n  }, \"Welcome back, \", name, \"!\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"btn-toolbar mb-2 mb-md-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(TopSellerChart, {\n    products: products,\n    currentStocktake: latestInventoryId,\n    prevStocktake: previousInventory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ProductAlerts, {\n    levels: levels,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(StockRecords, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(DashBoardStocktaking, {\n    stocktake: stocktake,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  })))))));\n};\n\nexport default Dashboard;","map":{"version":3,"sources":["C:/Users/alans/bevstock/client/src/components/Dashboard.js"],"names":["React","Fragment","useState","useEffect","Link","Redirect","FaBeer","AiOutlineHome","MdLocalBar","RiScales2Fill","BsCardChecklist","TopSellerChart","ProductAlerts","toast","DashBoardStocktaking","StockRecords","Dashboard","setAuth","name","setName","stocktake","setStocktake","latestInventoryDate","setLatestInventoryDate","latestInventoryId","setLatestInventoryId","previousInventory","setPreviousInventory","products","setProducts","levels","setLevels","getSalesData","response","fetch","method","headers","token","localStorage","parseRes","json","console","log","error","message","checkStocktake","length","setItem","stocktake_id","stocktake_date","stockId","Number","getItem","userType","Stocktake","findLastStocktake","getName","user_name","err","getLevels","logout","e","preventDefault","clear","success"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect } from \"react\";\r\nimport { Link, Redirect } from \"react-router-dom\";\r\nimport { FaBeer } from \"react-icons/fa\";\r\nimport { AiOutlineHome } from \"react-icons/ai\";\r\nimport { MdLocalBar } from \"react-icons/md\";\r\nimport { RiScales2Fill } from \"react-icons/ri\";\r\nimport { BsCardChecklist } from \"react-icons/bs\";\r\nimport TopSellerChart from \"../components/TopSellerChart\";\r\nimport ProductAlerts from \"../components/inventory/ProductAlerts\";\r\n\r\nimport { toast } from \"react-toastify\";\r\nimport DashBoardStocktaking from \"./DashboardStocktaking\";\r\nimport StockRecords from \"./inventory/StockRecords\";\r\n\r\nconst Dashboard = ({ setAuth }) => {\r\n  const [name, setName] = useState(\"\");\r\n  const [stocktake, setStocktake] = useState(false);\r\n  const [latestInventoryDate, setLatestInventoryDate] = useState(\"\");\r\n  const [latestInventoryId, setLatestInventoryId] = useState(\"\");\r\n  const [previousInventory, setPreviousInventory] = useState(\"\");\r\n  const [products, setProducts] = useState([]);\r\n  const [levels, setLevels] = useState([]);\r\n\r\n  async function getSalesData() {\r\n    try {\r\n      const response = await fetch(\r\n        \"http://localhost:5000/products/get/distinct\",\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n      const parseRes = await response.json();\r\n      console.log(parseRes);\r\n      setProducts(parseRes);\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  async function checkStocktake() {\r\n    try {\r\n      const response = await fetch(\r\n        \"http://localhost:5000/stocktake/activestocktake\",\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n\r\n      const parseRes = await response.json();\r\n\r\n      if (parseRes.length > 0) {\r\n        setStocktake(parseRes);\r\n        localStorage.setItem(\"stocktake\", parseRes[0].stocktake_id);\r\n        localStorage.setItem(\"stocktakedate\", parseRes[0].stocktake_date);\r\n      } else {\r\n        console.log(\"no stocktake in progress\");\r\n      }\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  const stockId = Number(localStorage.getItem(\"stocktake\"));\r\n\r\n  const userType = localStorage.getItem(\"role\");\r\n\r\n  const Stocktake = () => {\r\n    if (stockId !== 0) {\r\n      console.log(\"stocktake in progress\");\r\n      setStocktake(true);\r\n    }\r\n  };\r\n\r\n  async function findLastStocktake() {\r\n    try {\r\n      const response = await fetch(\"http://localhost:5000/inventory/latest\", {\r\n        method: \"GET\",\r\n        headers: { token: localStorage.token },\r\n      });\r\n      const parseRes = await response.json();\r\n      setLatestInventoryDate(parseRes[0].stocktake_date);\r\n      setLatestInventoryId(parseRes[0].stocktake_id);\r\n      setPreviousInventory(parseRes[1].stocktake_id);\r\n\r\n      console.log(latestInventoryDate);\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  async function getName() {\r\n    try {\r\n      const response = await fetch(\"http://localhost:5000/dashboard/\", {\r\n        method: \"GET\",\r\n        headers: { token: localStorage.token },\r\n      });\r\n\r\n      const parseRes = await response.json();\r\n\r\n      setName(parseRes.user_name);\r\n      console.log(userType);\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  }\r\n\r\n  async function getLevels() {\r\n    try {\r\n      const response = await fetch(\r\n        `http://localhost:5000/inventory/levels/${latestInventoryId}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: { token: localStorage.token },\r\n        }\r\n      );\r\n\r\n      const parseRes = await response.json();\r\n\r\n      console.log(parseRes);\r\n      setLevels(parseRes);\r\n    } catch (err) {\r\n      console.log(err.message);\r\n    }\r\n  }\r\n\r\n  const logout = (e) => {\r\n    e.preventDefault();\r\n    localStorage.clear();\r\n    setAuth(false);\r\n    toast.success(\"Logged out succsessfully!\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    findLastStocktake();\r\n    checkStocktake();\r\n    Stocktake();\r\n    getName();\r\n    getSalesData();\r\n    if (latestInventoryId !== \"\") {\r\n      getLevels();\r\n    }\r\n  }, [latestInventoryId]);\r\n\r\n  return userType == \"User\" ? (\r\n    <Redirect to=\"/userdashboard\" />\r\n  ) : (\r\n    <Fragment>\r\n      <nav className=\"navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0\">\r\n        <a className=\"navbar-brand col-sm-3 col-md-2 mr-0\" href=\"#\">\r\n          BevStock\r\n        </a>\r\n        <ul className=\"navbar-nav px-3\">\r\n          <li className=\"nav-item text-nowrap\">\r\n            <a className=\"nav-link\" onClick={(e) => logout(e)} href=\"#\">\r\n              {name} : Sign out\r\n            </a>\r\n          </li>\r\n        </ul>\r\n      </nav>\r\n\r\n      <div className=\"container-fluid\">\r\n        <div className=\"row\">\r\n          <nav className=\"col-md-2 d-none d-md-block bg-light sidebar\">\r\n            <div className=\"sidebar-sticky\">\r\n              <ul className=\"nav flex-column\">\r\n                <li className=\"nav-item\">\r\n                  <a className=\"nav-link active\" href=\"#\">\r\n                    <AiOutlineHome /> Dashboard{\" \"}\r\n                    <span className=\"sr-only\">(current)</span>\r\n                  </a>\r\n                </li>\r\n                <li className=\"nav-item\">\r\n                  <Link className=\"nav-item nav-link\" to=\"/stocktaking\">\r\n                    <MdLocalBar /> View/Edit Stock Areas\r\n                  </Link>\r\n                </li>\r\n                <li className=\"nav-item\">\r\n                  <Link className=\"nav-link\" to=\"/stocktakelists\">\r\n                    <RiScales2Fill />\r\n                    {stocktake\r\n                      ? \"  Continue Stocktake\"\r\n                      : \"  Perform a Stocktake\"}\r\n                  </Link>\r\n                </li>\r\n                <li className=\"nav-item\">\r\n                  <Link\r\n                    className=\"nav-link\"\r\n                    to={`/inventory/${latestInventoryId}`}\r\n                  >\r\n                    <BsCardChecklist /> Inventory\r\n                  </Link>\r\n                </li>\r\n                <li className=\"nav-item\"></li>\r\n                <li className=\"nav-item\">\r\n                  <a className=\"nav-link\" href=\"#\">\r\n                    <span data-feather=\"layers\"></span>\r\n                    Integrations\r\n                  </a>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          </nav>\r\n\r\n          <main role=\"main\" className=\"col-md-9 ml-sm-auto col-lg-10 pt-3 px-4\">\r\n            <div className=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom\">\r\n              <h1 className=\"h2\">Welcome back, {name}!</h1>\r\n              <div className=\"btn-toolbar mb-2 mb-md-0\"></div>\r\n            </div>\r\n\r\n            <div className=\"row\">\r\n              <div className=\"col-md-6\">\r\n                <TopSellerChart\r\n                  products={products}\r\n                  currentStocktake={latestInventoryId}\r\n                  prevStocktake={previousInventory}\r\n                />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <ProductAlerts levels={levels} />\r\n              </div>\r\n            </div>\r\n            <div className=\"row\">\r\n              <div className=\"col-md-6\">\r\n                <StockRecords />\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <DashBoardStocktaking stocktake={stocktake} />\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}